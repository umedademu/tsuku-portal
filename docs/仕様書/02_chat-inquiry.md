# 02 チャット型問い合わせの考え方

## 1. 目的
- 会話形式で質問に答えながらスムーズに問い合わせできる窓口を用意する。
- 必要な情報を抜け漏れなく集め、担当者へわかりやすく伝える。
- 途中で入力をやめても再開しやすい体験にする。

## 2. 基本構成
- 画面はモーダル表示とページ表示のどちらでも使えるようにする。
- 会話の流れ、入力済みの内容、エラー状態をまとめて扱える仕組みを用意する。
- 問い合わせ送信用APIと、AI補助用APIの2種類を呼び出す。
- ファイル添付は安全なURLを発行してアップロードし、サーバー側で管理する。

## 3. 会話の流れ
1. **あいさつ**  
   - 「どのような目的ですか？」などの案内と選択肢を表示。
   - 選択肢例：診断してほしい / 資料を受け取りたい / 相談したい。
2. **目的別の質問**  
   - 診断：課題、業種、予算、導入希望時期など。
   - 資料：会社名、役職、関心のある内容、送付先など。
   - 相談：自由記述、希望する連絡方法、希望日時など。
3. **共通の質問**  
   - 氏名（必須）、メールアドレス（必須）、電話番号（任意）、会社名（任意）。
4. **ファイル添付（任意）**  
   - 1件のみ、10MBまで。代表的な業務ファイルと画像ファイルに対応。
5. **同意確認**  
   - 個人情報の取り扱いについてチェックボックスで同意を得る。
6. **内容確認**  
   - 入力内容を一覧表示し、必要であれば戻って修正できるようにする。
7. **送信結果**  
   - 成功：受付番号と今後の流れを表示。
   - 失敗：原因を伝え、再送ボタンや別手段の案内を表示。

## 4. 入力チェック
- 氏名：40文字以内、空欄不可。
- メール：形式チェックを行う。将来的な二重登録チェックは別途検討。
- 電話：数字・ハイフン・プラス記号のみ。空欄でもよい。
- 添付：ファイル形式とサイズを確認し、合わない場合はエラーを返す。
- 同意：チェックがない状態では送信できないようにする。
- エラーメッセージは画面にも音声読み上げにも伝わる表示方法を採用する。

## 5. ユーザーインターフェース
- メッセージバブル、選択肢リスト、入力フォーム、進捗表示などを部品として整理する。
- キーボード操作やスクリーンリーダー利用でも問題なく使えるようにする。
- ファイル添付は進捗バーと削除ボタンを表示し、状況を把握しやすくする。

## 6. 状態と保存
- 代表的な状態：待機 → 入力中 → 確認 → 送信中 → 成功 / 失敗。
- 入力途中の内容は短時間であれば保存し、画面を閉じても再開できるようにする。
- 送信中は操作をロックし、進行中であることを明示する。

## 7. AI補助
- 診断目的では、入力内容をまとめたヒントや提案をAIで提示する。
- 応答が遅い場合は「回答を準備しています」と表示し、一定時間で諦める。
- AIが利用できないシチュエーションでは定型文で案内し、人が対応する方向に誘導する。

## 8. 通知
- 送信成功時は受付番号などを利用者に伝え、控えてもらう。
- メールやSlackなどの内部通知を行った場合は、その旨を画面に表示する。

## 9. ログと記録
- セッションIDなどの識別情報を付与し、問い合わせ内容と会話履歴を結びつける。
- 失敗時はエラーコードなどを記録し、後から原因を追いやすくする。
- AIの利用ログは概要のみ保存し、個人情報は含めない。

## 10. アクセシビリティ
- モーダルには適切な役割と属性を付与し、開閉時のフォーカスを制御する。
- ステップが切り替わった際は見出しなど重要な位置にフォーカスを移し、読み上げで伝わるようにする。
- タイピング中のアニメーションなどが邪魔にならないように配慮する。

## 11. エラー対応
- 通信エラー：再送ボタンを表示し、通信状況の確認を促す。
- 入力エラー：該当箇所を強調し、具体的な修正方法を示す。
- サーバー側のエラー：入力内容を保持したまま、別連絡先などを提示する。
- AIエラー：定型メッセージでフォローし、担当者対応へ切り替える。

## 12. テスト観点
- モバイル・PCでの操作性、入力のしやすさ。
- 中断と再開、低速回線でのファイル添付など現実的な利用シナリオ。
- 入力エラー、同意忘れ、ファイルサイズ超過などの異常ケース。
- AIの遅延・失敗時のフォールバック表示。

## 13. 今後の拡張アイデア
- 複数ファイル添付、ドラッグ＆ドロップ、電子署名。
- 会員ログインによる情報の自動入力。
- 多言語対応や有人オペレーターへの切り替え。
